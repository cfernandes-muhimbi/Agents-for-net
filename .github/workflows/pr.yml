name: Build and Deploy

on:
  pull_request:
    branches:
      - main

permissions:
  id-token: write 
  contents: read  

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Get Azure DevOps Access Token
      id: getToken
      uses: "./.github/actions/get-ado-token"
      with:
       client-id: ${{ secrets.AZURE_CLIENT_ID }}
       tenant-id: ${{ secrets.AZURE_TENANT_ID }}
       organization: ${{ secrets.ADO_ORGANIZATION }}

    - uses: Azure/pipelines@v1
      with:
        azure-devops-project-url: 'https://dev.azure.com/dynamicscrm/OneCRM'
        azure-pipeline-name: 'Agents-dotnet-pr' # name of the Azure pipeline to be triggered
        azure-devops-token: '${{ steps.getToken.outputs.token }}'
        azure-pipeline-variables:  '{"ProjectBranch": "main"}'